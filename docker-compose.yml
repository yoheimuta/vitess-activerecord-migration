services:
  migration:
    build: .
    command: bash -c "bundle install -j4 && tail -f /dev/null"
    container_name: migration
    volumes:
      - bundle:/usr/local/bundle
      - .:/migration
    networks:
      - migration-default
  migration-endtoend:
    build: ./test/endtoend
    container_name: migration-endtoend
    privileged: true
    volumes:
      - .:/endtoend
      - tmp:/endtoend/tmp
    ports:
      # http
      - "53303:3303"
      # mysql (vtgate)
      - "53306:3306"
    networks:
      - migration-default
  migration-mysql:
    image: mysql:8.0
    container_name: migration-mysql
    ports:
      - "18306:3306"
    environment:
      MYSQL_ALLOW_EMPTY_PASSWORD: yes
    networks:
      - migration-default

networks:
  migration-default:

volumes:
  bundle:
  tmp:
